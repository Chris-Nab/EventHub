<div th:fragment="eventForm">
  <form
    th:action="@{${isEdit} ? '/event/edit/' + ${event.eventId} : '/eventForm'}"
    th:object="${event}"
    method="post"
  >
    <input type="hidden" th:field="*{eventId}" />
    <div class="formFields">
      <div class="formTitle formTitle-center">
        <h1 th:text="${isEdit} ? 'Edit event' : 'Create a new event'">
          Create a new event
        </h1>
      </div>
      <!-- Left column -->
      <div>
        <label for="name">Event Name</label>
        <input
          type="text"
          id="name"
          th:field="*{name}"
          required
          minlength="2"
          maxlength="30"
        />
        <span
          th:if="${#fields.hasErrors('name')}"
          th:errors="*{name}"
          class="error"
        ></span>
      </div>
      <div>
        <label for="desc">Short Description</label>
        <input
          type="text"
          id="desc"
          th:field="*{desc}"
          required
          minlength="2"
          maxlength="75"
        />
        <span
          th:if="${#fields.hasErrors('desc')}"
          th:errors="*{desc}"
          class="error"
        ></span>
      </div>
      <div>
        <label for="dateTime">Date and Time</label>
        <input
          type="datetime-local"
          id="dateTime"
          name="dateTime"
          th:value="${formattedDateTime}"
          required
        />
        <span
          th:if="${#fields.hasErrors('dateTime')}"
          th:errors="*{dateTime}"
          class="error"
        ></span>
      </div>
      <div>
        <label for="location">Location</label>
        <input
          type="text"
          id="location"
          th:field="*{location}"
          required
          minlength="2"
          maxlength="40"
        />
        <span
          th:if="${#fields.hasErrors('location')}"
          th:errors="*{location}"
          class="error"
        ></span>
      </div>
      <!-- Right column -->
      <div>
        <label for="category">Select Category (up to 3):</label>
        <p style="font-size: 0.8em; color: gray">
          Hold CTRL (Windows/Linux) or âŒ˜ (Mac) to select multiple categories.
        </p>
        <select
          style="width: 350px"
          name="categoryIds"
          id="categories"
          multiple
        >
          <option
            th:each="category : ${categories}"
            th:text="${category.name}"
            th:value="${category.categoryId}"
          ></option>
        </select>
      </div>

      <script>
        // allows only 3 option selections and de-selects anymore
        document.addEventListener("DOMContentLoaded", () => {
          const select = document.getElementById("categories");
          select.addEventListener("change", () => {
            console.log("Select changed!");
            const selected = Array.from(select.selectedOptions);
            if (selected.length > 3) {
              alert("You can select up to 3 categories only.");
              selected[selected.length - 1].selected = false;
            }
          });
        });
      </script>
      <div>
        <label for="capacity">Capacity</label>
        <input type="number" id="capacity" th:field="*{capacity}" required />
        <span
          th:if="${#fields.hasErrors('capacity')}"
          th:errors="*{capacity}"
          class="error"
        ></span>
      </div>
      <div>
        <label for="price">Price</label>
        <input
          type="number"
          id="price"
          th:field="*{price}"
          step="any"
          required
        />
        <span
          th:if="${#fields.hasErrors('price')}"
          th:errors="*{price}"
          class="error"
        ></span>
      </div>

      <!-- NEW FIELDS (used by modal) -->
      <div style="grid-column: 1 / -1">
        <label for="detailedDescription">Detailed Description</label>
        <textarea
          id="detailedDescription"
          th:field="*{detailedDescription}"
          rows="4"
          maxlength="2000"
          placeholder="Provide a thorough description of your event"
        ></textarea>
        <span
          th:if="${#fields.hasErrors('detailedDescription')}"
          th:errors="*{detailedDescription}"
          class="error"
        ></span>
      </div>

      <div style="grid-column: 1 / -1">
        <label for="agenda">Agenda (one item per line)</label>
        <textarea
          id="agenda"
          th:field="*{agenda}"
          rows="4"
          maxlength="2000"
          placeholder="Insert a new line (pressing enter key) for each item in the agenda"
        ></textarea>
        <span
          th:if="${#fields.hasErrors('agenda')}"
          th:errors="*{agenda}"
          class="error"
        ></span>
      </div>

      <div>
        <label for="speakers">Speakers</label>
        <input
          id="speakers"
          type="text"
          th:field="*{speakers}"
          maxlength="255"
          placeholder="Jane Doe; John Smith"
        />
        <span
          th:if="${#fields.hasErrors('speakers')}"
          th:errors="*{speakers}"
          class="error"
        ></span>
      </div>

      <div>
        <label for="dressCode">Dress Code</label>
        <input
          id="dressCode"
          type="text"
          th:field="*{dressCode}"
          maxlength="120"
          placeholder="Smart casual"
        />
        <span
          th:if="${#fields.hasErrors('dressCode')}"
          th:errors="*{dressCode}"
          class="error"
        ></span>
      </div>
    </div>
    <div class="saveEvent">
      <a th:href="@{/}"> Cancel </a>
      <button type="submit" th:text="${isEdit} ? 'Update' : 'Save'">
        Save
      </button>
    </div>
    <div class="confirmationMsg">
      <p th:if="${confirmation}" th:text="${confirmation}"></p>
    </div>
  </form>
</div>
