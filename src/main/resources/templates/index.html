<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  lang="en"
  th:replace="~{components/layout :: layout(~{::title}, ~{::section})}"
>
  <head>
    <title>EventHub</title>
  </head>
  <body>
    <section class="page">
      <!-- Hero -->
      <div class="hero">
        <div class="hero-text">
          <h1>Discover Amazing Events in your university</h1>
          <p>
            Connect with your university clubs and societies through exciting events, workshops, and meetups. 
            Find events that match your interests and create lasting memories.
          </p>
          <div class="hero-cta">
            <a href="#" class="btn btn-light">Sign in</a>
            <a href="#" class="btn btn-dark">Register</a>
          </div>
        </div>
      </div>
      <div class="hero-media">
        <div class="media-placeholder">
          <div class="hero-wrap">
            <img class="hero-img" th:src="@{/homePage.jpg}" alt="Home page image">
          </div>
        </div>
      </div>

      <!-- Section title -->
      <h2 class="section-title">
        Browsing events in <span class="muted">RMIT</span>
      </h2>

      <!-- Labels/filters (static placeholders for now) -->
      <div class="chip-row">
        <div th:replace="~{components/eventFilters :: filterForm}"></div>
  
      </div>

      <!-- <div class="createEventBtn">
        <a  th:href="@{/eventPage}" class="btn btn-dark"> Create Event </a>
      </div> -->

      <!-- Showing event cards-->
      <div class="cards">
        <!--When there are no events -->
        <div class="empty-events" th:if="${#lists.isEmpty(events)}">
          No upcoming events
        </div>

        <article
          th:each="event : ${events}"
          class="card"
          th:if="${!#lists.isEmpty(events)}"
        >
          <div class="card-body">
            <h3 class="card-title" th:text="${event.name}">Event</h3>
            <div class="card-price">
              <span th:text="${event.price != null && event.price > 0 ? '$' + #numbers.formatDecimal(event.price , 1, 'COMMA', 2, 'POINT') : 'Free'}">Free</span>
            </div>
            <p class="card-text" th:text="${event.description != null ? event.description : 'Event description goes here...'}">Body text.</p>
            
            <!-- Event Categories -->
            <div class="card-categories" th:if="${!#lists.isEmpty(event.category)}">
              <span th:each="catName : ${event.category}" class="chip" th:text="${catName}">Category</span>
            </div>

            <!-- Event Details -->
            <div class="card-meta">
              <span class="meta-item">üìÖ <span th:text="${#temporals.format(event.dateTime, 'MMM d')}">Date</span></span>
              <span class="meta-item">üìç <span th:text="${event.location}">Location</span></span>
            </div>

          <div class="card-media">
            <div class="img-placeholder">
              <div class="placeholder-icon">
                <img th:src="@{${event.imageUrl}}" alt="event image" class="event-card-image">
              </div>
            </div>
          </div>  

          <!-- RSVP Buttons -->
              <form th:action="@{'/rsvp/' + ${currentUserId} + '/event/' + ${event.eventId}}" method="get" class="rsvp-form">
                <button 
                  type="submit"
                  style="width:100%"
                  th:classappend="${rsvpStatusMap[event.eventId]} ? 'btn btn-green submit-button' : 'btn btn-dark submit-button'"
                  th:disabled="${rsvpStatusMap[event.eventId]}"
                  th:text="${rsvpStatusMap[event.eventId]} ? 'RSVPed' : 'RSVP'"
                >RSVP</button>
              </form>
              <div th:if = "${rsvpStatusMap[event.eventId]}">
                <form th:action="@{'/rsvp/' + ${currentUserId} + '/event/' + ${event.eventId} + '/delete'}" method="post"
                      onsubmit="return confirm('Are you sure you want to DELETE this RSVP ?');">
                  <button 
                    type="submit"
                    style="width:100%"
                    class="btn submit-button"
                    th:text="'Cancel this RSVP'"
                  >Cancel this RSVP</button>
                </form>
              </div>

        </article>
      </div>
      </div>

      <!-- Stats (placeholders) -->
      <div class="stats">
        <div class="stat">
          <div class="stat-num">24+</div>
          <div class="stat-sub">Organizers use our website</div>
        </div>
        <div class="stat">
          <div class="stat-num">17M</div>
          <div class="stat-sub">Number of current users</div>
        </div>
        <div class="stat">
          <div class="stat-num">+95%</div>
          <div class="stat-sub">Customer satisfaction</div>
        </div>
      </div>
    </section>
  </body>
</html>
